<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Claude Design Bridge</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 12px;
      padding: 16px;
      background: #f8f9fa;
      color: #1a1a1a;
    }
    
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .header h1 {
      font-size: 16px;
      font-weight: 600;
      color: #0066cc;
    }
    
    .status {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      border: 1px solid #e1e5e9;
    }
    
    .status.connected {
      background: #e8f5e8;
      border-color: #4caf50;
    }
    
    .status.error {
      background: #ffeaea;
      border-color: #f44336;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status.connected .status-dot {
      background: #4caf50;
    }
    
    .status.error .status-dot {
      background: #f44336;
    }
    
    .test-section {
      margin-bottom: 20px;
    }
    
    .test-section h3 {
      font-size: 14px;
      margin-bottom: 12px;
      color: #333;
    }
    
    .button {
      background: #0066cc;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      width: 100%;
      margin-bottom: 8px;
    }
    
    .button:hover {
      background: #0052a3;
    }
    
    .button.secondary {
      background: #6c757d;
    }
    
    .button.secondary:hover {
      background: #545b62;
    }
    
    .button.danger {
      background: #dc3545;
    }
    
    .button.danger:hover {
      background: #c82333;
    }
    
    .log {
      background: #fff;
      border: 1px solid #e1e5e9;
      border-radius: 6px;
      padding: 12px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 10px;
      max-height: 150px;
      overflow-y: auto;
      white-space: pre-wrap;
      margin-top: 12px;
    }
    
    .form-group {
      margin-bottom: 12px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 4px;
      font-weight: 500;
      font-size: 11px;
      color: #666;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #e1e5e9;
      border-radius: 4px;
      font-size: 12px;
    }
    
    .form-group textarea {
      height: 60px;
      resize: vertical;
    }
    
    .form-row {
      display: flex;
      gap: 8px;
    }
    
    .form-row .form-group {
      flex: 1;
    }
    
    .tabs {
      display: flex;
      border-bottom: 1px solid #e1e5e9;
      margin-bottom: 16px;
    }
    
    .tab {
      background: none;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 12px;
      color: #666;
      border-bottom: 2px solid transparent;
    }
    
    .tab.active {
      color: #0066cc;
      border-bottom-color: #0066cc;
    }
    
    .tab:hover {
      color: #0052a3;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .color-swatch {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      border: 1px solid #ccc;
      display: inline-block;
      vertical-align: middle;
      margin-left: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üé® Claude Design Bridge</h1>
  </div>
  
  <div id="connection-status" class="status error">
    <div>
      <span class="status-dot"></span>
      <span id="status-text">Checking connection...</span>
    </div>
  </div>
  
  <div class="tabs">
    <button class="tab active" data-tab="design">Design</button>
    <button class="tab" data-tab="create">Create</button>
    <button class="tab" data-tab="extract">Extract</button>
    <button class="tab" data-tab="settings">Settings</button>
  </div>
  
  <!-- Design Creation Tab -->
  <div id="design-tab" class="tab-content active">
    <div class="test-section">
      <h3>Quick Design Creation</h3>
      <button class="button" id="create-drivechain-icon">üîó Create Drivechain Icon</button>
      <button class="button" id="create-blue-rectangle">üü¶ Create Blue Rectangle</button>
      <button class="button" id="create-red-circle">üî¥ Create Red Circle</button>
      <button class="button" id="create-text-node">üìù Create Text Node</button>
    </div>
    
    <div class="test-section">
      <h3>Natural Language Design</h3>
      <div class="form-group">
        <label>Design Instruction</label>
        <textarea id="design-instruction" placeholder="e.g., 'Create a large blue circle at position 200,150' or 'Make a red rectangle size 300x200'"></textarea>
      </div>
      <button class="button" id="execute-instruction">üöÄ Execute Design</button>
    </div>
  </div>
  
  <!-- Custom Creation Tab -->
  <div id="create-tab" class="tab-content">
    <div class="test-section">
      <h3>Custom Design Command</h3>
      <div class="form-group">
        <label>Shape Type</label>
        <select id="shape-type">
          <option value="rectangle">Rectangle</option>
          <option value="ellipse">Circle</option>
          <option value="text">Text</option>
          <option value="frame">Frame</option>
        </select>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label>Position X</label>
          <input type="number" id="pos-x" value="100" />
        </div>
        <div class="form-group">
          <label>Position Y</label>
          <input type="number" id="pos-y" value="100" />
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label>Width</label>
          <input type="number" id="width" value="200" />
        </div>
        <div class="form-group">
          <label>Height</label>
          <input type="number" id="height" value="150" />
        </div>
      </div>
      
      <div class="form-group">
        <label>Fill Color</label>
        <input type="color" id="fill-color" value="#4F46E5" />
        <span class="color-swatch" id="color-preview" style="background-color: #4F46E5;"></span>
      </div>
      
      <div class="form-group" id="text-options" style="display: none;">
        <label>Text Content</label>
        <input type="text" id="text-content" placeholder="Enter text content" />
      </div>
      
      <button class="button" id="create-custom">üé® Create Custom Shape</button>
    </div>
  </div>
  
  <!-- Extract Tab -->
  <div id="extract-tab" class="tab-content">
    <div class="test-section">
      <h3>Design Extraction</h3>
      <button class="button" id="extract-selection">üì§ Extract Selected</button>
      <button class="button secondary" id="generate-code">‚ö° Generate Code</button>
      <button class="button secondary" id="sync-tokens">üîÑ Sync Design Tokens</button>
    </div>
  </div>
  
  <!-- Settings Tab -->
  <div id="settings-tab" class="tab-content">
    <div class="test-section">
      <h3>Connection</h3>
      <button class="button secondary" id="test-connection">üîå Test MCP Connection</button>
    </div>
    
    <div class="test-section">
      <h3>Framework Settings</h3>
      <div class="form-group">
        <label>Framework</label>
        <select id="framework-select">
          <option value="react">React</option>
          <option value="vue">Vue</option>
          <option value="angular">Angular</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Design System</label>
        <select id="design-system-select">
          <option value="shadcn">shadcn/ui</option>
          <option value="mui">Material-UI</option>
          <option value="antd">Ant Design</option>
        </select>
      </div>
    </div>
    
    <div class="test-section">
      <h3>Debug</h3>
      <button class="button danger" id="clear-log">üßπ Clear Log</button>
    </div>
  </div>
  
  <div id="log" class="log"></div>

  <script>
    let logElement = document.getElementById('log');
    let connectionStatus = document.getElementById('connection-status');
    let statusText = document.getElementById('status-text');
    
    // Tab management
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const targetTab = tab.getAttribute('data-tab');
        
        // Update active tab
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Update active content
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.getElementById(targetTab + '-tab').classList.add('active');
      });
    });
    
    // Shape type change handler
    document.getElementById('shape-type').addEventListener('change', (e) => {
      const textOptions = document.getElementById('text-options');
      textOptions.style.display = e.target.value === 'text' ? 'block' : 'none';
    });
    
    // Color preview update
    document.getElementById('fill-color').addEventListener('change', (e) => {
      document.getElementById('color-preview').style.backgroundColor = e.target.value;
    });
    
    function log(message) {
      const timestamp = new Date().toLocaleTimeString();
      logElement.textContent += `[${timestamp}] ${message}\n`;
      logElement.scrollTop = logElement.scrollHeight;
    }
    
    function updateConnectionStatus(status, message) {
      statusText.textContent = message;
      connectionStatus.className = `status ${status}`;
    }
    
    function hexToRgbObject(hex) {
      const r = parseInt(hex.slice(1, 3), 16) / 255;
      const g = parseInt(hex.slice(3, 5), 16) / 255;
      const b = parseInt(hex.slice(5, 7), 16) / 255;
      return { r, g, b };
    }
    
    // Event listeners for design creation
    document.getElementById('create-drivechain-icon').onclick = () => {
      const command = {
        type: 'create',
        shape: 'frame',
        properties: {
          x: 100,
          y: 500,
          width: 200,
          height: 200,
          fills: [{ type: 'SOLID', color: { r: 0.08, g: 0.14, b: 0.26 } }]
        }
      };
      parent.postMessage({ pluginMessage: { type: 'design-command', command } }, '*');
      log('Creating drivechain icon frame...');
    };
    
    document.getElementById('create-blue-rectangle').onclick = async () => {
      log('Creating professional blue button...');
      try {
        const response = await fetch('http://localhost:3001/claude-design', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            instruction: 'create a professional blue rectangular button with rounded corners, 200px wide, 50px tall, positioned at 100,100 with subtle shadow' 
          })
        });
        const commands = await response.json();
        if (commands && commands.length > 0) {
          commands.forEach(command => {
            parent.postMessage({ pluginMessage: { type: 'design-command', command } }, '*');
          });
        }
      } catch (error) {
        log(`Error creating blue button: ${error.message}`);
      }
    };
    
    document.getElementById('create-red-circle').onclick = async () => {
      log('Creating professional red notification badge...');
      try {
        const response = await fetch('http://localhost:3001/claude-design', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            instruction: 'create a professional red circular notification badge, 80px diameter, positioned at 300,100 with subtle glow effect and modern design' 
          })
        });
        const commands = await response.json();
        if (commands && commands.length > 0) {
          commands.forEach(command => {
            parent.postMessage({ pluginMessage: { type: 'design-command', command } }, '*');
          });
        }
      } catch (error) {
        log(`Error creating red badge: ${error.message}`);
      }
    };
    
    document.getElementById('create-text-node').onclick = async () => {
      log('Creating professional heading text...');
      try {
        const response = await fetch('http://localhost:3001/claude-design', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            instruction: 'create a professional heading text saying "Claude Code Design Bridge" positioned at 500,100 with modern typography, 28px font size, dark gray color' 
          })
        });
        const commands = await response.json();
        if (commands && commands.length > 0) {
          commands.forEach(command => {
            parent.postMessage({ pluginMessage: { type: 'design-command', command } }, '*');
          });
        }
      } catch (error) {
        log(`Error creating text: ${error.message}`);
      }
    };
    
    document.getElementById('execute-instruction').onclick = async () => {
      const instruction = document.getElementById('design-instruction').value.trim();
      if (!instruction) {
        log('Please enter a design instruction');
        return;
      }
      
      try {
        // Send to MCP server for natural language processing
        const response = await fetch('http://localhost:3001/claude-design', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ instruction })
        });
        
        if (response.ok) {
          const result = await response.json();
          log(`Natural language processed: ${result.commandsGenerated} command(s) generated`);
          
          // Execute generated commands
          for (const command of result.commands) {
            parent.postMessage({ pluginMessage: { type: 'design-command', command } }, '*');
          }
        } else {
          log('Failed to process natural language instruction');
        }
      } catch (error) {
        log(`Error: ${error.message}`);
      }
    };
    
    document.getElementById('create-custom').onclick = () => {
      const shapeType = document.getElementById('shape-type').value;
      const fillColorHex = document.getElementById('fill-color').value;
      const fillColor = hexToRgbObject(fillColorHex);
      
      const command = {
        type: 'create',
        shape: shapeType,
        properties: {
          x: parseInt(document.getElementById('pos-x').value),
          y: parseInt(document.getElementById('pos-y').value),
          width: parseInt(document.getElementById('width').value),
          height: parseInt(document.getElementById('height').value),
          fills: [{ type: 'SOLID', color: fillColor }]
        }
      };
      
      if (shapeType === 'text') {
        command.properties.text = document.getElementById('text-content').value || 'Sample Text';
        command.properties.fontSize = 16;
      }
      
      parent.postMessage({ pluginMessage: { type: 'design-command', command } }, '*');
      log(`Creating custom ${shapeType}...`);
    };
    
    // Other event listeners
    document.getElementById('test-connection').onclick = () => {
      parent.postMessage({ pluginMessage: { type: 'test-connection' } }, '*');
      log('Testing MCP connection...');
    };
    
    document.getElementById('extract-selection').onclick = () => {
      parent.postMessage({ pluginMessage: { type: 'extract-design' } }, '*');
      log('Extracting selected designs...');
    };
    
    document.getElementById('generate-code').onclick = () => {
      parent.postMessage({ pluginMessage: { type: 'generate-code' } }, '*');
      log('Generating code...');
    };
    
    document.getElementById('sync-tokens').onclick = () => {
      parent.postMessage({ pluginMessage: { type: 'sync-design-tokens' } }, '*');
      log('Syncing design tokens...');
    };
    
    document.getElementById('clear-log').onclick = () => {
      logElement.textContent = '';
      log('Log cleared');
    };
    
    // Handle messages from main thread
    onmessage = (event) => {
      const message = event.data.pluginMessage;
      
      switch (message.type) {
        case 'connection-status':
          updateConnectionStatus(message.status, message.message);
          log(`Connection: ${message.message}`);
          break;
          
        case 'command-executed':
          log(`‚úì Successfully executed: ${message.command.type} ${message.command.shape}`);
          if (message.nodeId) {
            log(`  Node ID: ${message.nodeId}`);
          }
          break;
          
        case 'command-error':
          log(`‚úó Error: ${message.error}`);
          break;
          
        case 'design-extracted':
          log(`‚úì Design extracted: ${message.specs.length} component(s)`);
          break;
          
        case 'code-generated':
          log(`‚úì Code generated: ${(message.files && message.files.length) || 1} file(s)`);
          break;
          
        case 'error':
          log(`‚úó Error: ${message.message}`);
          break;
      }
    };
    
    // Initial connection test
    setTimeout(() => {
      parent.postMessage({ pluginMessage: { type: 'test-connection' } }, '*');
    }, 500);
  </script>
</body>
</html>